#!/bin/bash
#-------------------------------------------------------------------------------------------------#
# AUTHOR:  Andrew Michaud                                                                         #
#          https://andrewmichaud.com                                                              #
# FILE:    menu                                                                                   #
# PURPOSE: File for choosing things with dmenu.                                                   #
# UPDATED: 2015-08-27                                                                             #
# LICENSE: MIT/BSD                                                                                #
#-------------------------------------------------------------------------------------------------#

# Choose something with dmenu.  Takes prefix and regex and type.
choose () {

    # I guess we can check errors.
    if [ -z "$1" ] || [ -z "$2" ] || [ -z "$3" ]; then
        echo "[menu] [ERROR] Not enough parameters given to choose!"
        exit 1
    fi

    # Choose (wisely).
    echo "[menu] Mode $3"
    choice=$(find "$1" -regex "$2" | sed "s|$1/||" | dmenu -o 0.9 -i)
    [ -n "$choice" ] || exit
    echo "[menu] Selected $choice"
}

# Passwords with pass password manager the standard UNIX password manager.
if [ "$1" = "pass" ]; then

    # I need this because of some XMonad weirdness.
    [ -z "$PASSWORD_STORE_DIR" ] && source "$HOME/.zshrc"
    # Copy pass to clipboard.
    choose "${PASSWORD_STORE_DIR}" ".*\.\(gpg\)" "pass"
    pass show -c "${choice/.gpg/}" 2>/dev/null

# Videos with mpv.
elif [ "$1" = "vid" ]; then

    # Play movie.
    choose "$HOME/videos" ".*\.\(mkv\|mp4\|avi\|vob\)" "video"
    mpv "$HOME/videos/$choice" & disown

# Music with mpd.
elif [ "$1" = "music" ]; then

    # Clear mpd playlist and play this playlist instead.
    choose "$HOME/music/playlists" ".*\.\(m3u\)" "music"
    mpc clear && mpc load "${choice/.m3u}" && mpc play

else
    echo "[menu] Unsupported selection!"
fi
