#!/bin/bash

# Choose something with dmenu.  Takes prefix and regex.
choose () {

    # I guess we can check errors.
    if [ -z "$1" ]; then
        echo "[menu] [ERROR] No parameters given to choose!"
        exit 1
    elif [ -z "$2" ]; then
        echo "[menu] [ERROR] Only one parameter given to choose!"
        exit 1
    fi

    # Choose (wisely).
    choice=$(find "$1" -regex "$2" | sed "s|$1/||" | dmenu -o 0.9)
    [ -n "$choice" ] || exit
    echo "[menu] Selected $choice"
}

# Passwords with pass password manager the standard UNIX password manager.
if [ "$1" = "pass" ]; then
    echo "[menu] Mode pass"

    # Copy pass to clipboard.
    choose "$PASSWORD_STORE_DIR" ".*\.\(gpg\)"
    pass show -c "${choice/.gpg/}" 2>/dev/null

# Videos with mpv.
elif [ "$1" = "vid" ]; then
    echo "[menu] Mode video"

    # Play movie.
    choose "$HOME/videos" ".*\.\(mkv\|mp4\|avi\|vob\)"
    mpv "$HOME/videos/$choice" &

# Music with mpd.
elif [ "$1" = "music" ]; then
    echo "[menu] Mode music"

    # Clear mpd playlist and play this playlist instead.
    choose "$HOME/music/playlists" ".*\.\(m3u\)"
    mpc clear && mpc load "${choice/.m3u}" && mpc play

else
    echo "[menu] Unsupported selection!"
fi
